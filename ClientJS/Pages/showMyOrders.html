<!DOCTYPE html>
<html>
<head>
    <title>הזמנות שלי</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link href="../CSS/showMyOrders.css" rel="stylesheet" />
    <link href="../CSS/massageTimer.css" rel="stylesheet" />
    <script src="../JS/ajaxCall.js"></script>

</head>
<body>

    <div id="content">
        <img src="../Img/logoNoCar.png" />
        <h1>הזמנות שלי</h1>
        <div dir="rtl">
            <button id="allReservationsBtn">כל ההזמנות</button>
            <button id="pendingReservationsBtn">הזמנות בהמתנה</button>
            <button id="approvedReservationsBtn">אושרו</button>
        </div>
        <div id="reservationsContainer"></div>

    </div>

    <!-- Navigation bar -->
    <nav>
        <a href="bookingPage.html"><span class="material-icons">add_circle</span><br>הזמנה חדשה</a>
        <a href="userHome.html"><span class="material-icons">home</span><br>בית</a>
        <a href="#"><span class="material-icons">list_alt</span><br>הזמנות שלי</a>
        <a href="updateMyProfile.html"><span class="material-icons">person</span><br>פרופיל</a>
    </nav>

    <!-- Modal Structure -->
    <div id="myModal" class="modal">
        <div class="modal-content">
          
            <img src="../Img/זמן חנייה.jpg"alt="Time Management" style="width:100%; height:auto;" />
            <h4 id="modalTitle">התראת מערכת</h4>
            <p id="modalText">ההתראה שלך כאן</p>
            <button class="modal-close-btn">אישור</button>
        </div>
        
    </div>


    <script>
        // Sample reservation data
        const reservationData = [
            {
                id: 1,
                parkingLot: "חנייה רופין",
                reservationDate: "05/03/2024",
                startTime: "8:44 PM",
                endTime: "10:00 PM",
                status: "approved",
            },
            {
                id: 2,
                parkingLot: "חנייה מתא",
                reservationDate: "09/05/2019",
                startTime: "10:00 AM",
                endTime: "12:00 PM",
                status: "pending",
            },
        ];

        // Function to display a reservation
        function displayReservation(reservation) {
            const reservationBox = document.createElement("div");
            reservationBox.className = "reservation-box";
            const statusIcon =
                reservation.status === "approved"
                    ? '<i class="material-icons status-icon approved" style="color: green;  top: 10px; left: 10px;">done</i>'
                    : '<i class="material-icons status-icon pending" style="color: orange;  top: 10px; left: 10px;">warning</i>';


            const actions =
                reservation.status === "approved"
                    ? `
                                <button class="start-button" data-reservation-id="${reservation.id}">התחל חניה</button>
                                <button class="full-button">חנייה טפוסה</button>

                            `
                    : `<button class="cancel-button" data-reservation-id="${reservation.id}">בטל הזמנה</button>`;

            reservationBox.innerHTML = `
                        <h3>${reservation.parkingLot}</h3>
                        <p>${reservation.reservationDate} ${reservation.startTime} - ${reservation.endTime}</p>
                        ${statusIcon}
                        <div class="actions">${actions}</div>
                    `;

            return reservationBox;
        }

        // Function to display all reservations
        function displayAllReservations(reservations) {
            const reservationsContainer = document.querySelector("#reservationsContainer");
            reservationsContainer.innerHTML = "";

            reservations.forEach((reservation) => {
                const reservationBox = displayReservation(reservation);
                reservationsContainer.appendChild(reservationBox);
            });
        }


        displayAllReservations(reservationData);


        document.querySelector("#allReservationsBtn").addEventListener("click", () => {
            displayAllReservations(reservationData);
        });

        document.querySelector("#pendingReservationsBtn").addEventListener("click", () => {
            const pendingReservations = reservationData.filter(reservation => reservation.status === "pending");
            displayAllReservations(pendingReservations);
        });

        document.querySelector("#approvedReservationsBtn").addEventListener("click", () => {
            const approvedReservations = reservationData.filter(reservation => reservation.status === "approved");
            displayAllReservations(approvedReservations);
        });


        document.querySelectorAll(".cancel-button").forEach((button) => {
            button.addEventListener("click", (event) => {
                const reservationId = parseInt(event.target.dataset.reservationId);

                console.log("Cancel Reservation ID:", reservationId);
            });
        });


        document.querySelectorAll(".start-button").forEach((button) => {
            button.addEventListener("click", (event) => {
                const reservationId = parseInt(event.target.dataset.reservationId);
                const reservation = reservationData.find(r => r.id === reservationId);

                // Check if the reservation ID is valid
                if (!reservation) {
                    showModal("התראת תאריך", "מצטערים, לא נמצאה הזמנה עם מזהה כזה.");
                    return;
                }

                const reservationStartTime = new Date(`${reservation.reservationDate} ${reservation.startTime}`);
                const reservationEndTime = new Date(`${reservation.reservationDate} ${reservation.endTime}`);
                const now = new Date();

                // Check if the current date is the same as the reservation date
                if (now.getFullYear() !== reservationStartTime.getFullYear() ||
                    now.getMonth() !== reservationStartTime.getMonth() ||
                    now.getDate() !== reservationStartTime.getDate()) {
                    showModal("התראת תאריך", "מצטערים, זה לא התאריך של ההזמנה.");
                    return;
                }

                // Check if the current time is before the reservation start time
                if (now < reservationStartTime) {
                    showModal("התראת זמן התחלה", `מצטערים, זה לא מותאם לזמן שהזמנת. אתה יכול להפעיל רק ב-${reservation.startTime}`);
                    return;
                }

                // Check if the current time is after the reservation end time
                if (now >= reservationEndTime) {
                    showModal("התראת זמן סיום", "מצטערים, זמן החנייה שהזמנת כבר פג תוקף.");
                    return;
                }

                sessionStorage.setItem('currentParking', JSON.stringify(reservation));
                window.location.href = 'parkingTimer.html'; // כתובת לדף הטיימר
            });
        });

        function showModal(title, message) {
            document.getElementById("modalTitle").textContent = title;
            document.getElementById("modalText").textContent = message;
            document.getElementById("myModal").style.display = "block";
        }

        // Get the button that closes the modal
        var btn = document.querySelector(".modal-close-btn");

        // When the user clicks on the button, close

        // When the user clicks on the button, close the modal
        btn.onclick = function () {
            document.getElementById("myModal").style.display = "none";
        }

    </script>
</body>
</html>
